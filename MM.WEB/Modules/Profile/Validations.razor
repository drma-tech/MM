@page "/profile/validation"

@attribute [Authorize]
@using MM.Shared.Models.Profile
@using MM.Shared.Models.Profile.Core
@using MM.WEB.Api
@using MM.WEB.Modules.Profile.Core
@using Button = MM.WEB.Resources.Button
@using Microsoft.AspNetCore.Authorization
@inherits PageCore<Validations>

@inject ValidationApi ValidationApi
@inject ProfileApi ProfileApi
@inject StorageApi StorageApi

<NewRenderControl Actions="Actions" Instance="Validation" ExpressionEmpty="(ValidationModel? obj) => obj == null"
                  PrivateFeature="true" IsAuthenticated="AppStateStatic.IsAuthenticated">
    <MudStack Row="true" Spacing="4" Breakpoint="Breakpoint.Xs">
        <MudGrid>
            <MudItem xs="12">
                <FieldActive For="@(() => Validation!.Gallery)" @bind-Value="@Validation!.Gallery" CssIcon="@IconsFA.Solid.Icon("images").Font"></FieldActive>
            </MudItem>
            <MudItem xs="12">
                <FieldActive For="@(() => Validation!.Identity)" @bind-Value="@Validation!.Identity" CssIcon="@IconsFA.Solid.Icon("id-card").Font"
                             Disabled="true" CustomButtonText="Only available in phase 2">
                </FieldActive>
            </MudItem>
        </MudGrid>
        <MudGrid>
            <MudItem xs="12">
                <FieldActive For="@(() => Validation!.NetWorth)" @bind-Value="@Validation!.NetWorth" CssIcon="@IconsFA.Solid.Icon("gem").Font"
                             Disabled="true" CustomButtonText="Only available in phase 3">
                </FieldActive>
            </MudItem>
            <MudItem xs="12">
                <FieldActive For="@(() => Validation!.AnnualIncome)" @bind-Value="@Validation!.AnnualIncome" CssIcon="@IconsFA.Solid.Icon("money-bill").Font"
                             Disabled="true" CustomButtonText="Only available in phase 3">
                </FieldActive>
            </MudItem>
        </MudGrid>
    </MudStack>
</NewRenderControl>

<FloatingButton Template="Template.Back"></FloatingButton>

@code {
    private ValidationModel? Validation { get; set; }
    private ValidationValidation ValidationValidator { get; set; } = new();
    public ComponentActions<ValidationModel?> Actions { get; set; } = new();

    protected override async Task LoadAuthDataAsync()
    {
        Actions?.StartLoading?.Invoke(null);

        Validation = await ValidationApi.Get();

        if (Validation == null)
        {
            Validation = new ValidationModel();
        }

        Actions?.FinishLoading?.Invoke(Validation);
    }

}